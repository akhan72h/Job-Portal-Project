<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Job Portal</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <header>
      <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
          <a class="navbar-brand job-prtl" href="#">Job Portal</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="Home.html"
                  >HOME</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="addJob.html"
                  >ADD JOBS</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="myJob.html"
                  >MY JOBS</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="employee.html"
                  >EMPLOYEES</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="profile.html"
                  >PROFILE</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="Login.html">LOG OUT</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <section>
      <div class="container">
        <div class="row">
          <div class="col-12">
            <div class="search-container-wrapper">
              <h1 class="H1">Jobs</h1>
              <div class="search-container">
                <input
                  class="search-input"
                  type="text"
                  placeholder="Search job..."
                />
                <span class="fa-solid fa-magnifying-glass"></span>
              </div>
              <div class="image-container">
                <img
                  id="job-image"
                  class="img"
                  src="images/lines.webp"
                  alt=""
                />
              </div>
            </div>
          </div>
        </div>
        <div class="row row-margin" id="job-cards-container">
          <!-- Job apply button will be inserted here -->
        </div>
      </div>
    </section>

    <!-- Bootstrap Modal for sort job, filter job -->
    <div
      class="modal fade"
      id="jobModal"
      tabindex="-1"
      aria-labelledby="jobModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="jobModalLabel">Job Filter</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row d-flex justify-content-around mt-4">
              <div class="col">
                <label for="job-type1">Job Type</label>
              </div>
              <div class="col">
                <input type="checkbox" id="Full Time" name="Full Time" />
                <label for="Full Time">Full Time</label>
              </div>
              <div class="col">
                <input type="checkbox" id="Part Time" name="Part Time" />
                <label for="Part Time">Part Time</label>
              </div>
              <div class="col">
                <input
                  type="checkbox"
                  id="Work From Home"
                  name="Work From Home"
                />
                <label for="Work From Home">Work From Home</label>
              </div>
            </div>

            <div class="row d-flex justify-content-around mt-4">
              <div class="col">
                <label for="salary">Salary Range</label>
              </div>

              <div class="slider-container col-5">
                <input
                  type="range"
                  class="range-input"
                  id="salaryRange"
                  min="30000"
                  max="150000"
                  step="1000"
                  value="75000"
                  oninput="updateSliderValue()"
                />
              </div>
              <div class="slider-value col mx-4 text-center" id="sliderValue">
                $75,000
              </div>
            </div>

            <div class="row d-flex justify-content-around mt-4">
              <div class="col">
                <label for="duration">Duration</label>
              </div>
              <div class="col-9">
                <select type="select" id="salary" name="salary">
                  <option value="1">Flexible</option>
                  <option value="2">1 month</option>
                  <option value="3">2 month</option>
                  <option value="4">3 month</option>
                  <option value="5">4 month</option>
                  <option value="6">5 month</option>
                  <option value="7">6 month</option>
                </select>
              </div>
            </div>

            <div class="row d-flex justify-content-around mt-4 mb-4">
              <div class="col">
                <label for="sort">Sort</label>
              </div>
              <div class="col">
                <input type="checkbox" id="Salary" name="Salary" />
                <label for="Salary">
                  Salary <i class="fa-solid fa-arrow-up"></i>
                </label>
              </div>
              <div class="col">
                <input type="checkbox" id="Duration" name="Duration" />
                <label for="Duration">
                  Duration <i class="fa-solid fa-arrow-up"></i>
                </label>
              </div>
              <div class="col">
                <input type="checkbox" id="Rating" name="Rating" />
                <label for="Rating">
                  Rating <i class="fa-solid fa-arrow-up"></i>
                </label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary">Apply</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Job Application Modal -->
    <div
      class="modal fade"
      id="applyModal"
      tabindex="-1"
      aria-labelledby="applyModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="applyModalLabel text-center">
              Apply for Job
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="applyForm">
              <input type="hidden" id="applyJobId" name="jobId" />
              <div class="mb-3">
                <label for="applicantName" class="form-label">Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="applicantName"
                  name="applicantName"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="applicantEmail" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="applicantEmail"
                  name="applicantEmail"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="coverLetter" class="form-label">Resume</label>
                <input
                  type="file"
                  class="form-control"
                  id="Resume"
                  name="Resume"
                  rows="4"
                  required
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-primary"
              onclick="submitApplication()"
            >
              Submit Application
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      document
        .getElementById("job-image")
        .addEventListener("click", function () {
          var myModal = new bootstrap.Modal(
            document.getElementById("jobModal")
          );
          myModal.show();
        });

      function updateSliderValue() {
        var slider = document.getElementById("salaryRange");
        var output = document.getElementById("sliderValue");
        output.textContent = "$" + parseInt(slider.value).toLocaleString();
      }

      function changeSliderValue(amount) {
        var slider = document.getElementById("salaryRange");
        slider.value = parseInt(slider.value) + amount;
        if (slider.value < slider.min) {
          slider.value = slider.min;
        }
        if (slider.value > slider.max) {
          slider.value = slider.max;
        }
        updateSliderValue();
      }

      // Initialize slider value display
      updateSliderValue();
    </script>

    <script>
      let MyToken = localStorage.getItem("token");

      async function displayData() {
        let response = await fetch("http://localhost:4444/api/jobs?myjobs=1", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${MyToken}`,
          },
        });

        let data = await response.json();
        display(data);
      }

      const display = (jobs) => {
        let jobCardsContainer = document.getElementById("job-cards-container");
        jobCardsContainer.innerHTML = jobs
          .map(
            (job) => `
        <div class="row mb-4">
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-body">
                        <h2 class="card-title">${job.title}</h2>
                        <p class="card-text">Salary: ${job.salary}</p>
                        <p class="card-text">Skill Sets: ${job.skillsets}</p>
                        <p class="card-text">Job Type: ${job.jobType}</p>
                        <p class="card-text">Duration: ${job.duration}</p>
                        <p class="card-text">Deadline: ${job.deadline}</p>
                        <p class="card-text">Maximum Applicants can apply: ${job.maxApplicants}</p>
                        <p class="card-text">Maximum Positions Available: ${job.maxPositions}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <button class="btn mb-2 apply-btn" onclick="JobApply('${job._id}')">Apply</button>
                        
                    </div>
                </div>
            </div>
        </div>
    `
          )
          .join("");
      };

      displayData();

      function JobApply(jobId) {
        // Set the job ID in the hidden input field
        document.getElementById("applyJobId").value = jobId;

        // Show the job application modal
        var myModal = new bootstrap.Modal(
          document.getElementById("applyModal")
        );
        myModal.show();
      }

      async function submitApplication() {
        // Retrieve form values
        const jobId = document.getElementById("applyJobId").value;
        const applicantName = document.getElementById("applicantName").value;
        const applicantEmail = document.getElementById("applicantEmail").value;
        const coverLetter = document.getElementById("coverLetter").value;

        // Validate form inputs
        if (!applicantName || !applicantEmail || !coverLetter) {
          Swal.fire({
            title: "Error!",
            text: "Please fill out all fields.",
            icon: "error",
            confirmButtonText: "OK",
          });
          return;
        }

        // Create the application data object
        const applicationData = {
          jobId: jobId,
          applicantName: applicantName,
          applicantEmail: applicantEmail,
          coverLetter: coverLetter,
        };

        // Submit the application
        try {
          let response = await fetch(
            "http://localhost:4444/api/applications",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${MyToken}`,
              },
              body: JSON.stringify(applicationData),
            }
          );

          let data = await response.json();

          if (data.message === "Application submitted successfully") {
            Swal.fire({
              title: "Success!",
              text: data.message,
              icon: "success",
              confirmButtonText: "OK",
            }).then(() => {
              // Hide the modal and clear the form
              var myModal = bootstrap.Modal.getInstance(
                document.getElementById("applyModal")
              );
              myModal.hide();
              document.getElementById("applyForm").reset();
            });
          } else {
            Swal.fire({
              title: "Error!",
              text: data.message,
              icon: "error",
              confirmButtonText: "OK",
            });
          }
        } catch (error) {
          Swal.fire({
            title: "Error!",
            text: "There was a problem submitting your application.",
            icon: "error",
            confirmButtonText: "OK",
          });
        }
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </body>
</html>
